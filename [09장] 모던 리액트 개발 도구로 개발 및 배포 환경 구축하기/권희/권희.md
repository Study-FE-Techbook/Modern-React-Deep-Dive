# 09ì¥: ëª¨ë˜ ë¦¬ì•¡íŠ¸ ê°œë°œ ë„êµ¬ë¡œ ê°œë°œ ë° ë°°í¬ í™˜ê²½ êµ¬ì¶•í•˜ê¸°

## 9.1 Next.jsë¡œ ë¦¬ì•¡íŠ¸ ê°œë°œ í™˜ê²½ êµ¬ì¶•í•˜ê¸°

### create-next-app ì—†ì´ í•˜ë‚˜ì”© êµ¬ì¶•í•˜ê¸°

1. `npm init`

ëª¨ë“  Node.js í”„ë¡œì íŠ¸ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ê°€ì¥ ë¨¼ì € í•  ì¼ì€ package.jsonì„ ë§Œë“œëŠ” ê²ƒì´ë‹¤.

2. `npm i react react-dom next`

ì´í›„ í•„ìš”í•œ í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ react, react-dom, nextë¥¼ ì„¤ì¹˜í•˜ì.

react

- ì›¹ ë˜ëŠ” ë¸Œë¼ìš°ì €ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ë‹ˆë¼, UIë¥¼ component í˜•íƒœë¡œ êµ¬ì„±í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
- UIì˜ ë³€ê²½ ì‚¬í•­ì„ íŒŒì•…í•˜ê³ , ë³€ê²½ëœ ìŠ¤ëƒ…ìƒ·ì„ react-domì— ì „ë‹¬

react-dom

- reactì—ê²Œ ë°›ì€ ë³€ê²½ëœ ìŠ¤ëƒ…ìƒ·ê³¼ ì‹¤ì œ ë¸Œë¼ìš°ì € DOMì„ ë¹„êµí•˜ë©° ì‹¤ì§ˆì ìœ¼ë¡œ ë¸Œë¼ìš°ì € DOM ì¡°ì‘

3. `npm i -D @types/node @types/react @types/react-dom eslint eslint-config-next typescript`

ì´í›„ devDependenciesì— í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ì.

### tsconfig.json ì‘ì„±í•˜ê¸°

npm ì„¤ì •ì„ package.jsonì—ì„œ í–ˆë‹¤ë©´ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •ì€ tsconfig.jsonì— ê¸°ë¡í•œë‹¤.

```json
{
  "compilerOptions": {
    "target": "ES5",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "baseUrl": "src",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
```

- compilerOptions: TSë¥¼ JSë¡œ ì»´íŒŒì¼í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì˜µì…˜
  - target: ë³€í™˜ì„ ëª©í‘œë¡œ í•˜ëŠ” ì–¸ì–´ì˜ ë²„ì „
  - lib: ê¸°ë³¸ íƒ€ì… ì •ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬(d.ts)ë¥¼ ì–´ë–¤ ê²ƒì„ ì‚¬ìš©í•  ê²ƒì¸ì§€ ì •í•œë‹¤.
  - allowJs: TSê°€ JS ë˜í•œ ì»´íŒŒì¼í• ì§€ë¥¼ ê²°ì •
  - skipLibCheck: ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” d.tsì— ëŒ€í•œ ê²€ì‚¬ ì—¬ë¶€
  - strict: ê¸°ë³¸ ì˜µì…˜
  - forceConsistentCasingInFileNames: íŒŒì¼ ì´ë¦„ì˜ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ë„ë¡ ê°•ì œ
  - noEmit: ì»´íŒŒì¼ì„ í•˜ì§€ ì•Šê³  íƒ€ì… ì²´í¬ë§Œ í•œë‹¤. Next.jsëŠ” swcê°€ TS íŒŒì¼ì„ ì»´íŒŒì¼í•˜ë¯€ë¡œ êµ³ì´ TSê°€ JSë¥¼ ì»´íŒŒì¼í•  í•„ìš”ê°€ ì—†ë‹¤.
  - esModuleInterop: CommonJS ë°©ì‹ìœ¼ë¡œ ë³´ë‚¸ ëª¨ë“ˆì„ ES ëª¨ë“ˆ ë°©ì‹ì˜ importë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
  - module: ëª¨ë“ˆ ì‹œìŠ¤í…œì„ ì„¤ì •í•œë‹¤.
  - moduleResolution: ëª¨ë“ˆì„ í•´ì„í•˜ëŠ” ë°©ì‹ì„ ì„¤ì •í•œë‹¤.
  - resolveJsonModule: JSON íŒŒì¼ì„ import í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
  - isolateModules: ë‹¤ë¥¸ ëª¨ë“ˆ ì‹œìŠ¤í…œê³¼ ì—°ê³„ë˜ì§€ ì•Šê³  ë‹¨ë…ìœ¼ë¡œ ìˆëŠ” íŒŒì¼ì˜ ìƒì„±ì„ ë§‰ê¸° ìœ„í•œ ì˜µì…˜
  - jsx: jsxë¥¼ ì–´ë–»ê²Œ ì»´íŒŒì¼í• ì§€ ì„¤ì •í•œë‹¤.
  - incremental: ë§ˆì§€ë§‰ ì»´íŒŒì¼ ì •ë³´ë¥¼ ë””ìŠ¤í¬ì— ì €ì¥í•œë‹¤.
  - baseUrl: ëª¨ë“ˆì„ ì°¾ì„ ë•Œ ê¸°ì¤€ì´ ë˜ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ì§€ì •í•œë‹¤.
  - paths: ì ˆëŒ€ ê²½ë¡œì— ëŒ€í•œ ë³„ì¹­ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
  - include: TS ì»´íŒŒì¼ ëŒ€ìƒì—ì„œ í¬í•¨ì‹œí‚¬ íŒŒì¼ ëª©ë¡ì„ ì˜ë¯¸í•œë‹¤.
  - exclude: TS ì»´íŒŒì¼ ëŒ€ìƒì—ì„œ ì œì™¸ì‹œí‚¬ íŒŒì¼ ëª©ë¡ì„ ì˜ë¯¸í•œë‹¤.

### next.config.js ì‘ì„±í•˜ê¸°

Next.js ì„¤ì •ì„ ìœ„í•œ next.config.jsë¥¼ ë§Œë“¤ ì°¨ë¡€ë‹¤.

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  poweredByHeader: false,
  eslint: {
    ignoreDuringBuilds: true,
  },
};

module.exports = nextConfig;
```

### ESLintì™€ Prettier ì„¤ì •í•˜ê¸°

#### ESLint

```json
{
  "root": true,
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint"],
  "parserOptions": {
    "project": "./tsconfig.json",
    "createDefaultProgram": true
  },
  "env": {
    "browser": true,
    "node": true,
    "es6": true
  },
  "extends": [
    "airbnb",
    "airbnb-typescript",
    "airbnb/hooks",
    "next/core-web-vitals",
    "plugin:@typescript-eslint/recommended",
    "prettier"
  ],
  "rules": {
    "react/react-in-jsx-scope": "off",
    "react/jsx-props-no-spreading": "off",
    "@typescript-eslint/semi": "off",
    "react/jsx-filename-extension": ["warn", { "extensions": [".ts", ".tsx"] }],
    "no-useless-catch": "off",
    "@typescript-eslint/no-unused-vars": "warn",
    "react/require-default-props": "off",
    "react/jsx-no-useless-fragment": "warn",
    "react-hooks/exhaustive-deps": "off",
    "import/prefer-default-export": "off",
    "jsx-a11y/label-has-associated-control": [
      "error",
      {
        "labelAttributes": ["htmlFor"]
      }
    ]
  },
  "overrides": [
    {
      "files": ["*.tsx", "*.jsx"],
      "rules": {
        "@typescript-eslint/no-use-before-define": "off"
      }
    }
  ],
  "ignorePatterns": ["next.config.js"]
}
```

#### Prettier

```json
{
  "printWidth": 80,
  "singleQuote": false,
  "jsxSingleQuote": false,
  "tabWidth": 2,
  "semi": true,
  "trailingComma": "all",
  "bracketSpacing": true,
  "arrowParens": "always",
  "endOfLine": "lf",
  "importOrder": ["^@core/(.*)$", "^@server/(.*)$", "^@ui/(.*)$", "^[./]"],
  "importOrderSeparation": true,
  "importOrderSortSpecifiers": true,
  "plugins": ["@trivago/prettier-plugin-sort-imports"]
}
```

## 9.2 ê¹ƒí—ˆë¸Œ 100% í™œìš©í•˜ê¸°

### CI/CD

#### CI

> ì§€ì†ì  í†µí•©

1. ì½”ë“œ ë³€ê²½ì‚¬í•­ì„ ì£¼ê¸°ì ìœ¼ë¡œ ë¹ˆë²ˆí•˜ê²Œ ë¨¸ì§€í•´ì•¼ í•œë‹¤.
2. í†µí•©ì„ ìœ„í•œ ë‹¨ê³„(ë¹Œë“œ, í…ŒìŠ¤íŠ¸)ì˜ ìë™í™”

![alt text](image-2.png)

CI Serverì—ì„œ ë¹Œë“œ, í…ŒìŠ¤íŠ¸ë¥¼ ê±°ì¹œë‹¤. Jenkinsì™€ ê°™ì´ ì™¸ë¶€ì— CI Serverë¥¼ ë‘ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ,
Github Actionì„ í†µí•´ ë” ì‰½ê²Œ ìë™í™” ë‹¨ê³„ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆë‹¤.

#### CD

> ì§€ì†ì ì¸ ì œê³µ / ì§€ì†ì ì¸ ë°°í¬

1. ì§€ì†ì ì¸ ì œê³µ

ë°°í¬í•  ì¤€ë¹„ ê³¼ì •ì„ ìë™ìœ¼ë¡œ ê±°ì¹˜ê³ , í›„ì— ê²€ì¦í•œ í›„(QA) ìˆ˜ë™ìœ¼ë¡œ ë°°í¬

2. ì§€ì†ì ì¸ ë°°í¬

ë°°í¬ê¹Œì§€ ëª¨ë“  ê³¼ì •ì„ ìë™í™”

![alt text](image-1.png)

### ê¹ƒí—ˆë¸Œ ì•¡ì…˜ìœ¼ë¡œ CI í™˜ê²½ êµ¬ì¶•í•˜ê¸°

**ëª©í‘œ: mainìœ¼ë¡œ PR ì˜¬ë¼ì˜¬ ë•Œë§ˆë‹¤ ë¹Œë“œ, í…ŒìŠ¤íŠ¸ ìë™í™” í•´ë³´ê¸°**

- Event: Githubì—ì„œ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ë¥¼ ì§€ì •
- Workflows: íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì–´ë–¤ ì¼ì„ ìˆ˜í–‰í•˜ê³  ì‹¶ì€ì§€ ëª…ì‹œí•˜ëŠ” ê³³
- Jobs: Workflows ì•ˆì— ë‹¤ìˆ˜ì˜ Jobì´ ì¡´ì¬í•˜ë©° ë³‘ë ¬ë¡œ ì‹¤í–‰ì´ ë¨
- Actions: Runnerì—ì„œ ì‹¤í–‰ë˜ëŠ” í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„
- Runners: Jobsì„ ì‹¤í–‰í•˜ëŠ” VM ë¨¸ì‹ 

![alt text](image-3.png)

```yml
// .github/workflows/ci.yml

name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "20"

      - name: Install dependencies
        run: npm install

      - name: Build the project
        run: npm run build

      - name: Run tests
        run: npm test
```

#### test ì½”ë“œ í†µê³¼ê°€ ì‹¤íŒ¨ëœ ê²½ìš°

![alt text](image-4.png)
![alt text](image-5.png)

## 9.4 ë¦¬ì•¡íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë„ì»¤ë¼ì´ì¦ˆí•˜ê¸°

### Docker

> ë¦¬ëˆ…ìŠ¤ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì˜¤í”ˆì†ŒìŠ¤ ê°€ìƒí™” í”Œë«í¼

#### Docker ì‚¬ìš© ì´ìœ 

1. ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ¨í‚¤ì§• íˆ´ / ì‹¤í–‰ í™˜ê²½ ë¶ˆì¼ì¹˜ì˜ í•´ê²°

ex) ìœˆë„ìš°ì—ì„œ ëª¨ë“  ê°œë°œì„ ì™„ë£Œí•œ ìƒí™©ì—ì„œ ì½”ë“œë¥¼ ì„œë²„ë¡œ ì˜¬ë ¸ì„ ë•Œ,
ì„œë²„ê°€ ë¦¬ëˆ…ìŠ¤ë¼ì„œ ì½”ë“œê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ” ê²½ìš°

![alt text](image-6.png)

2. ì„œë²„ ìì› ê´€ë¦¬

ex) 64GB ë©”ëª¨ë¦¬ë¥¼ ê°€ì§€ê³  ìˆëŠ” ì„œë²„, ë³´í†µ ì†Œí”„íŠ¸ì›¨ì–´ê°€ í•„ìš”í•œ ë©”ëª¨ë¦¬ëŠ” 2GB

=> í•˜ë‚˜ì˜ ì„œë²„ì—ì„œ ë‹¤ë¥¸ ê°œë°œ í™˜ê²½ì˜ ë§ì€ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‹¤í–‰í•´ì•¼ í•¨!

![alt text](image-7.png)

#### Virtual Machine vs Container

![alt text](image-8.png)

VM ê¸°ìˆ ì€ ì´ë¯¸ì§€ì— ìš´ì˜ ì²´ì œê°€ í¬í•¨ë˜ì–´ ìˆì–´ ë¬´ê²ê³  ëŠë¦° ë°˜ë©´, Container ê¸°ìˆ ì€ ê°€ë³ê³  ë¹ ë¥´ë‹¤.

ì»¨í…Œì´ë„ˆê°€ êµ¬ë™ë˜ê¸° ìœ„í•´ì„œëŠ” Container Engineì´ë¼ëŠ” ê²ƒì´ í•„ìš”í•˜ê³ ,
Container Engine ì¤‘ì— ê°€ì¥ ëŒ€í‘œì ì¸ ê²ƒì´ Docker Engineì´ë‹¤.

ì»¨í…Œì´ë„ˆ ê¸°ìˆ ì€ Docker ë§Œì˜ ê¸°ìˆ ? => âŒ

#### Dockerfile, Image, Container

- Dockerfile: ì»¨í…Œì´ë„ˆë¥¼ ì–´ë–»ê²Œ ë§Œë“¤ì–´ì•¼ í•˜ëŠ”ì§€ ì„¤ëª…ì„œ
- Image: ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ + Dockerfile (í´ë˜ìŠ¤)
- Container: ì´ë¯¸ì§€ë¥¼ ì´ìš©í•´ì„œ ê³ ë¦½ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒ, ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‘í•¨ (ì¸ìŠ¤í„´ìŠ¤)

**ì´ë¯¸ì§€ë§Œ ìˆë‹¤ë©´ Dockerë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ëª¨ë“  í™˜ê²½ì—ì„œ ë™ì¼í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.**

### Dockerë¡œ ë°°í¬í•´ë³´ê¸°

ê·¸ë ‡ë‹¤ë©´ ì§€ê¸ˆê¹Œì§€ ê°œë°œí•˜ë©´ì„œ Dockerë¥¼ ì ‘í•˜ì§€ ëª»í–ˆë˜ ì´ìœ ëŠ” ë­˜ê¹Œ?
ì´ì „ Dockerì˜ ì‚¬ìš© ì´ìœ ì—ì„œ ë´¤ë“¯ì´ DockerëŠ” ì„œë²„ ìì› ê´€ë¦¬ì— ì‚¬ìš©ë˜ê±°ë‚˜, ì„œë²„ì— ì½”ë“œë¥¼ ì˜¬ë¦´ ë•Œ ì‚¬ìš©í•œë‹¤.
ì„œë²„ ìì› ê´€ë¦¬ëŠ” ë“¤ì–´ë³¸ì ë„ ì—†ê³ , ë°°í¬ëŠ” ì›¹ í˜¸ìŠ¤íŒ…ì„ ì£¼ë¡œ ì´ìš©í–ˆìœ¼ë¯€ë¡œ Dockerë¥¼ ì‚¬ìš©í•  ì¼ì´ ì—†ì—ˆë‹¤.

Dockerë¡œ ë°°í¬ ì‹¤ìŠµì„ í•´ë³´ì.

**ëª©í‘œ: Dockerë¡œ í™ˆ ì„œë²„ / í´ë¼ìš°ë“œ ë°°í¬í•´ë³´ê¸°**

next.config.jsì— ë‹¤ìŒê³¼ ê°™ì€ ì˜µì…˜ì„ ì¶”ê°€í•œë‹¤.

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  // ...
  output: "standalone",
};

module.exports = nextConfig;
```

```Dockerfile
FROM node:18-alpine AS base

# Install dependencies only when needed
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /usr/src/app

# Install dependencies based on the preferred package manager
COPY package*.json ./
RUN npm install
RUN rm -rf ./.next/cache

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /usr/src/app
COPY --from=deps /usr/src/app/node_modules ./node_modules
COPY . .
RUN npm run build

# Production image, copy all the files and run next
FROM base AS runner
WORKDIR /usr/src/app

ENV NODE_ENV=production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder --chown=nextjs:nodejs /usr/src/app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /usr/src/app/.next/static ./.next/static

USER nextjs
EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

```
# docker image build
docker build . -t no-cli:latest

# docker image run
docker run -p 3000:3000 no-cli:latest

# docker hub push
docker push alexgoni/no-cli:latest
```

ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ localhost:3000ìœ¼ë¡œ ì‹¤í–‰ì´ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

Docker hubì— imageë¥¼ pushí•˜ê³ , GCP í´ë¼ìš°ë“œë¥¼ í†µí•´ ë°°í¬ë¥¼ í•´ë³´ë ¤ í–ˆìœ¼ë‚˜
Artifact Registry APIê°€ ìœ ë£Œì—¬ì„œ ì—¬ê¸°ê¹Œì§€ë§Œ ì§„í–‰í–ˆë‹¤. ã…

---

### ìƒˆë¡œ ì•Œê²Œëœ ê°œë…

- tsconfig.json ì„¤ì • ì˜µì…˜
- CI/CD ê°œë… & ê¹ƒí—ˆë¸Œ ì•¡ì…˜
- Docker ê°œë…

### ì½ìœ¼ë©´ì„œ ì–´ë ¤ì› ê±°ë‚˜ ì´í•´ê°€ ì˜ ì•ˆëë˜ ë¶€ë¶„

- Docker ì‹¤ìŠµ

---

### ì°¸ê³ ìë£Œ

- CI/CD 5ë¶„ ê°œë… ì •ë¦¬: https://www.youtube.com/watch?v=0Emq5FypiMM
- [10ë¶„ í…Œì½”í†¡] ë£¨ì¹´ì˜ CI/CD: https://www.youtube.com/watch?v=6awJbcWXsts
- ì œë°œ ê¹ƒí—ˆë¸Œ ì•¡ì…˜ğŸ”¥ ëª¨ë¥´ëŠ” ê°œë°œì ì—†ê²Œí•´ ì£¼ì„¸ìš” ğŸ™: https://www.youtube.com/watch?v=iLqGzEkusIw&t=297s
- Docker ê°€ ì™œ ì¢‹ì€ì§€ 5ë¶„ì•ˆì— ì„¤ëª…í•´ì¤Œ: https://www.youtube.com/watch?v=chnCcGCTyBg
- ë„ì»¤ í•œë°©ì— ì •ë¦¬ ğŸ³ (ëª¨ë“  ê°œë°œìë“¤ì´ ë°°ì›Œë³´ê³  ì‹¶ì–´ í•˜ëŠ” íˆ´!) + ì‹¤ìŠµ: https://www.youtube.com/watch?v=LXJhA3VWXFA&t=1097s
- ê°œë°œìë¥¼ ìœ„í•œ ì‰¬ìš´ ë„ì»¤ (2024 NEW) | ì»¨í…Œì´ë„ˆ, ë„ì»¤, ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ê°œë…ì„ ì—„ì²­ ì‰½ê²Œ ì•Œë ¤ë“œë ¤ìš”.: https://www.youtube.com/watch?v=eRfHp16qJq8
- ìƒí™œì½”ë”© Docker ì…êµ¬ ìˆ˜ì—…: https://www.youtube.com/watch?v=Ps8HDIAyPD0&list=PLuHgQVnccGMDeMJsGq2O-55Ymtx0IdKWf
