# [10ì¥] ë¦¬ì•¡íŠ¸ 17ê³¼ 18ì˜ ë³€ê²½ ì‚¬í•­ ì‚´í´ë³´ê¸°

## 10.1 ë¦¬ì•¡íŠ¸ 17 ë²„ì „ ì‚´í´ë³´ê¸°

**ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ ì½”ë“œì˜ ìˆ˜ì •ì„ í•„ìš”ë¡œ í•˜ëŠ” ë³€ê²½ ì‚¬í•­ì„ ìµœì†Œí™” í•¨. (í˜¸í™˜ì„± ê¹¨ì§ X)**

16 â†’ 17ë²„ì „ìœ¼ë¡œì˜ ë²„ì „ ì—…ì€ í° ë¶€ë‹´ì—†ì´ ìˆœì¡°ë¡­ê²Œ í•  ìˆ˜ ìˆë‹¤.

**âœ¨ë¦¬ì•¡íŠ¸ì˜ ì ì§„ì ì¸ ì—…ê·¸ë ˆì´ë“œ**

16ì—ì„œ ë” ì´ìƒ í˜¸í™˜ë˜ì§€ ì•ŠëŠ” APIê°€ ìˆê±°ë‚˜ ìƒˆë¡œìš´ ë¦¬ì•¡íŠ¸ 17ì„ ì‚¬ìš©í•˜ëŠ” ë° ìˆì–´ ì´ì „ê³¼ ì‘ë™ ë°©ì‹ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë‹¨í–‰ëœ ì£¼ ë²„ì „ ì—…ë°ì´íŠ¸ë‹¤.

**âœ¨ì´ë²¤íŠ¸ ìœ„ì„ ë°©ì‹ì˜ ë³€ê²½**

ì´ë²¤íŠ¸ ìœ„ì„: ë¦¬ì•¡íŠ¸ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ í•´ë‹¹ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì¶”ê°€í•œ ê°ê°ì˜ DOM ìš”ì†Œì— ë¶€íƒí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì´ë²¤íŠ¸ íƒ€ì…(click, change)ë‹¹ í•˜ë‚˜ì˜ í•¸ë“¤ëŸ¬ë¥¼ ë£¨íŠ¸ì— ë¶€ì°©í•œë‹¤.

1. ìº¡ì²˜: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ íƒ€ê¹ƒ ë…¸ë“œì— ë„ë‹¬í•˜ëŠ” ë‹¨ê³„
2. íƒ€ê¹ƒ: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ íƒ€ê¹ƒ ë…¸ë“œì— ë„ë‹¬í•˜ëŠ” ë‹¨ê³„
3. ë²„ë¸”ë§: ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ìš”ì†Œì—ì„œë¶€í„° ì‹œì‘í•´ ìµœìƒìœ„ ìš”ì†Œê¹Œì§€ ë‹¤ì‹œ ì˜¬ë¼ê°.

â†’ ì´ëŸ¬í•œ ì´ë²¤íŠ¸ ë‹¨ê³„ì˜ ì›ë¦¬ë¥¼ í™œìš©í•´ ì´ë²¤íŠ¸ë¥¼ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ë§Œ ë¶™ì´ëŠ” ê²ƒ.

![alt text](image.png)

ë¦¬ì•¡íŠ¸ëŠ” ì´ë²¤íŠ¸ ìœ„ì„ë°©ì‹ì„ í†µí•´ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•œë‹¤.
â†’ íŠ¹ì • ì»´í¬ë„ŒíŠ¸ì˜ ë²„íŠ¼ì—ì„œ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë”ë¼ë„, ì‹¤ì œë¡œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” í•´ë‹¹ ë²„íŠ¼ì— ë¶™ì–´ìˆëŠ” ê²ƒì´ ì•„ë‹Œ root Element (16ë²„ì „ì—ëŠ” Document, 17ë²„ì „ë¶€í„°ëŠ” root DOM container)ì— ë¶™ì–´ìˆê²Œ ë˜ëŠ” ê²ƒ.

â†’ í•˜ë‚˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ ë‘ ë²„ì „ì˜ ë¦¬ì•¡íŠ¸ê°€ ì¡´ì¬í•œë‹¤ê³  í–ˆì„ ë•Œ, ë‘ ë²„ì „ì˜ ë¦¬ì•¡íŠ¸ê°€ ëª¨ë‘ Document Levelì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë¶€ì°©í•˜ê¸° ë•Œë¬¸ì— ë²„ê·¸ê°€ ìƒê¸°ê¸° ì‰¬ìš´ í™˜ê²½ì´ ëœë‹¤!!!!!

**âœ¨import React from â€˜reactâ€™ê°€ ë” ì´ìƒ í•„ìš” ì—†ë‹¤: ìƒˆë¡œìš´ JSX transform**

17ë¶€í„° ë°”ë²¨ê³¼ í˜‘ë ¥í•´ import êµ¬ë¬¸ ì—†ì´ë„ JSXë¥¼ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.

â†’ ë¶ˆí•„ìš”í•œ import êµ¬ë¬¸ì„ ì‚­ì œí•´ ë²ˆë“¤ë§ í¬ê¸°ë¥¼ ì•½ê°„ ì¤„ì¼ ìˆ˜ ìˆê³ , ì»´í¬ë„ŒíŠ¸ ì‘ì„±ì„ ë”ìš± ê°„ê²°í•˜ê²Œ í•´ì¤€ë‹¤.

**âœ¨ê·¸ ë°–ì˜ ì£¼ìš” ë³€ê²½ ì‚¬í•­**

**ğŸ“ì´ë²¤íŠ¸ í’€ë§ ì œê±°**

SyntheticEvent: ë¸Œë¼ìš°ì €ì˜ ê¸°ë³¸ ì´ë²¤íŠ¸ë¥¼ í•œ ë²ˆ ë” ê°ì‹¼ ì´ë²¤íŠ¸ ê°ì²´

ë¦¬ì•¡íŠ¸ëŠ” ê¸°ë³¸ ì´ë²¤íŠ¸ê°€ ì•„ë‹Œ í•œë²ˆ ë˜í•‘í•œ ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤ ì´ ì´ë²¤íŠ¸ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì•¼ í–ˆê³ , ê·¸ ê³¼ì •ì—ì„œ í•­ìƒ ìƒˆë¡œ ì´ë²¤íŠ¸ë¥¼ ë§Œë“¤ ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ í• ë‹¹ ì‘ì—…ì´ ì¼ì–´ë‚  ìˆ˜ë°–ì— ì—†ë‹¤. ë˜í•œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì´ë ‡ê²Œ ë§Œë“  ì´ë²¤íŠ¸ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í•´ì œí•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆë‹¤.

â†’ ì´ë²¤íŠ¸ í’€ë§: SyntheticEvent í’€ì„ ë§Œë“¤ì–´ì„œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤ ê°€ì ¸ì˜¤ëŠ” ê²ƒ.

![alt text](image-1.png)

1. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
2. í•©ì„± ì´ë²¤íŠ¸ í’€ì—ì„œ í•©ì„± ì´ë²¤íŠ¸ ê°ì²´ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
3. ì´ ì´ë²¤íŠ¸ ì •ë³´ë¥¼ í•©ì„± ì´ë²¤íŠ¸ ê°ì²´ì— ë„£ì–´ì¤€ë‹¤.
4. ìœ ì €ê°€ ì§€ì •í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì‹¤í–‰ëœë‹¤.
5. ì´ë²¤íŠ¸ ê°ì²´ê°€ ì´ˆê¸°í™”ë˜ê³  ë‹¤ì‹œ ì´ë²¤íŠ¸ í’€ë¡œ ëŒì•„ê°„ë‹¤.

â†’ ì–¸ëœ» ë³´ê¸°ì—ëŠ” ë©”ëª¨ë¦¬ë„ ì•„ë‚„ ìˆ˜ ìˆê³ , ë¶ˆí•„ìš”í•˜ê²Œ GCê°€ ìì£¼ ë™ì‘í•  í•„ìš”ë„ ì—†ì–´ì„œ íš¨ìœ¨ì ì¸ ì‹œìŠ¤í…œì¸ ê²ƒ ê°™ì•„ ë³´ì¸ë‹¤. í•˜ì§€ë§Œ ì´ë²¤íŠ¸ê°€ íŠ¸ë¦¬ê±° ë˜ì—ˆì„ ë•Œ ì¸ìŠ¤í„´ìŠ¤ í’€ì„ ë°›ì•„ì˜¤ê³  ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì¢…ë£Œë˜ìë§ˆì ë‹¤ì‹œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ releaseí•˜ëŠ” ë°©ì‹ì€ í•„ì—°ì ìœ¼ë¡œÂ **_ë¹„ë™ê¸° ì´ë²¤íŠ¸ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ëŒ€ì‘_**Â (e.persist())ì„ í•„ìš”ë¡œ í•œë‹¤.

â†’ ë¹„ë™ê¸° ì½”ë“œë¡œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ë³„ë„ ë©”ëª¨ë¦¬ ê³µê°„ì— í•©ì„± ì´ë²¤íŠ¸ ê°ì²´ë¥¼ í• ë‹¹í•´ì•¼ í•œë‹¤ëŠ” ì , ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì´ì™€ ê°™ì€ ë°©ì‹ì´ ì„±ëŠ¥ í–¥ìƒì— í¬ê²Œ ë„ì›€ì´ ì•ˆ ëœë‹¤ëŠ” ì ë•Œë¬¸ì— ì´ë²¤íŠ¸ í’€ë§ ê°œë…ì´ ì‚­ì œëë‹¤.

**ğŸ“useEffect í´ë¦°ì—… í•¨ìˆ˜ì˜ ë¹„ë™ê¸° ì‹¤í–‰**

ë¦¬ì•¡íŠ¸ì˜ useEffectì— ìˆëŠ” í´ë¦°ì—… í•¨ìˆ˜ëŠ” ë¦¬ì•¡íŠ¸ 16ë²„ì „ê¹Œì§€ëŠ” ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ëë‹¤.

ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ ì´ í´ë¦°ì—… í•¨ìˆ˜ê°€ ì™„ë£Œë˜ê¸° ì „ê¹Œì§€ëŠ” ë‹¤ë¥¸ ì‘ì—…ì„ ë°©í•´í•˜ë¯€ë¡œ ë¶ˆí•„ìš”í•œ ì„±ëŠ¥ ì €í•˜ë¡œ ì´ì–´ì§€ëŠ” ë¬¸ì œê°€ ì¡´ì¬í–ˆë‹¤.

â†’ 17ë¶€í„°ëŠ” í™”ë©´ì´ ì™„ì „íˆ ì—…ë°ì´íŠ¸ëœ ì´í›„ì— í´ë¦°ì—… í•¨ìˆ˜ê°€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.

**ğŸ“ì»´í¬ë„ŒíŠ¸ì˜ undefined ë°˜í™˜ì— ëŒ€í•œ ì¼ê´€ì ì¸ ì²˜ë¦¬**

16, 17ë²„ì „ì€ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ undefinedë¥¼ ë°˜í™˜í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. (ì˜ë„ì¹˜ ì•Šê²Œ ì˜ëª»ëœ ë°˜í™˜ìœ¼ë¡œ ì¸í•œ ì‹¤ìˆ˜ë¥¼ ë°©ì§€í•¨.)

- 16ì—ì„œ forwardRefë‚˜ memoì—ì„œ undefinedë¥¼ ë°˜í™˜í•˜ëŠ” ê²½ìš°ì—ëŠ” ë³„ë‹¤ë¥¸ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì—ˆìŒâ€¦
- 17ë¶€í„° ë‹¤ì‹œ ì—ëŸ¬ê°€ ì •ìƒì ìœ¼ë¡œ ë°œìƒí•¨
- 18ë¶€í„°ëŠ” undefinedë¥¼ ë°˜í™˜í•´ë„ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ.

## 10.2 ë¦¬ì•¡íŠ¸ 18ë²„ì „ ì‚´í´ë³´ê¸°

**âœ¨ìƒˆë¡œ ì¶”ê°€ëœ í›… ì‚´í´ë³´ê¸°**

**ğŸ“useId**

- ì»´í¬ë„ŒíŠ¸ ë³„ë¡œ ìœ ë‹ˆí¬í•œ ê°’ì„ ìƒì„±í•¨ (ê³ ìœ í•œ ID ìƒì„±)
- SSRí™˜ê²½ì—ì„œ ìœ ìš©í•˜ë©°, í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì—ì„œ ì¼ê´€ëœ IDë¥¼ ìƒì„±í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤.

```jsx
import React, { useId } from 'react'

const MyComponent = () => {
  const id = useId()

  return (
    <div>
      <label htmlFor={id}>Label</label>
      <input id={id} type="text" />
    </div>
  )
}

export default MyComponent
```

**ğŸ“useTransition**

- UIë³€ê²½ì„ ê°€ë¡œë§‰ì§€ ì•Šê³  ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆëŠ” ë¦¬ì•¡íŠ¸ í›… (ì¤‘ìš”í•œ ì‘ì—…ì„ ìš°ì„  ì²˜ë¦¬)
- ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ê¸´ê¸‰í•˜ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ê°„ì£¼í•´ ë¬´ê±°ìš´ ë Œë”ë§ ì‘ì—…ì„ ì¡°ê¸ˆ ë¯¸ë£° ìˆ˜ ìˆê³ , UX ì¢‹ë‹¤.

```jsx
const [isPending, startTransition] = useTransition()
// isPending: íŠ¸ëœì§€ì…˜ì´ ì§„í–‰ ì¤‘ì¸ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ìƒíƒœ
// startTransition: íŠ¸ëœì§€ì…˜ ì—…ë°ì´íŠ¸ë¥¼ ì‹œì‘í•˜ëŠ” í•¨ìˆ˜
```

```jsx
import React, { useState, useTransition } from 'react'

const MyComponent = () => {
  const [list, setList] = useState([])
  const [isPending, startTransition] = useTransition()

  const handleClick = () => {
    startTransition(() => {
      // í° ë°ì´í„° ì„¸íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ì‘ì—…ì„ íŠ¸ëœì§€ì…˜ìœ¼ë¡œ ì²˜ë¦¬
      const newList = Array.from(
        { length: 10000 },
        (_, index) => `Item ${index + 1}`
      )
      setList(newList)
    })
  }

  return (
    <div>
      <button onClick={handleClick}>Load Items</button>
      {isPending && <p>Loading...</p>}
      <ul>
        {list.map((item) => (
          <li key={item}>{item}</li>
        ))}
      </ul>
    </div>
  )
}

export default MyComponent
```

- í° ë°ì´í„° ì„¸íŠ¸ ë¡œë“œ, ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬, ì• ë‹ˆë©”ì´ì…˜ ë“± ë‹¤ì–‘í•œ ì‚¬ìš© ì‚¬ë¡€ì—ì„œ UI ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” ë° ìœ ìš©í•¨.

**ğŸ“useDeferredValue**

- ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì—ì„œ ë¦¬ë Œë”ë§ì´ ê¸‰í•˜ì§€ ì•Šì€ ë¶€ë¶„ì„ ì§€ì—°í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” í›…
- ê³ ì •ëœ ì§€ì—° ì‹œê°„ ì—†ì´ ì²« ë²ˆì§¸ ë Œë”ë§ì´ ì™„ë£Œëœ ì´í›„ì— ì´ useDeferredValueë¡œ ì§€ì—°ëœ ë Œë”ë§ì„ ìˆ˜í–‰í•œë‹¤. â†’ ì´ ì§€ì—°ëœ ë Œë”ë§ì€ ì¤‘ë‹¨í•  ìˆ˜ ìˆìœ¼ë©° ì‚¬ìš©ìì˜ ì¸í„°ë™ì…˜ì„ ì°¨ë‹¨í•˜ì§€ë„ ì•ŠëŠ”ë‹¤.

```jsx
const deferredValue = useDeferredValue(value)
// value: ì§€ì—°ì‹œí‚¤ê³ ì í•˜ëŠ” ì›ë˜ ê°’
// deferredValue: ì§€ì—°ëœ ê°’ìœ¼ë¡œ, valueê°€ ë³€ê²½ëœ í›„ ì¼ì • ì‹œê°„ ì§€ì—°ëœ ê°’ì„ ì œê³µ
```

```jsx
import React, { useState, useDeferredValue, useMemo } from 'react'

const FilterList = ({ input }) => {
  // ì…ë ¥ëœ ê°’ì— ë”°ë¼ í•„í„°ë§ëœ ëª©ë¡ ìƒì„±
  const filteredItems = useMemo(() => {
    return items.filter((item) =>
      item.toLowerCase().includes(input.toLowerCase())
    )
  }, [input])

  return (
    <ul>
      {filteredItems.map((item) => (
        <li key={item}>{item}</li>
      ))}
    </ul>
  )
}

const App = () => {
  const [input, setInput] = useState('')
  // ê¸‰í•˜ì§€ ì•Šì€ ë Œë”ë§ì„ ì§€ì—°ì‹œì¼œ UIì˜ ì‘ë‹µì„±ì„ ìœ ì§€
  const deferredInput = useDeferredValue(input)

  const handleChange = (event) => {
    setInput(event.target.value)
  }

  return (
    <div>
      <input
        type="text"
        value={input}
        onChange={handleChange}
        placeholder="Search..."
      />
      <FilterList input={deferredInput} />
    </div>
  )
}

const items = [
  'Apple',
  'Banana',
  'Cherry',
  'Date',
  'Elderberry',
  'Fig',
  'Grape',
  'Honeydew',
]

export default App
```

ì…ë ¥ í•„ë“œì™€ ê°™ì´ ì‚¬ìš©ìì˜ ì¦‰ê°ì ì¸ í”¼ë“œë°±ì´ í•„ìš”í•œ ë¶€ë¶„ê³¼ ëœ ì¤‘ìš”í•œ ì—…ë°ì´íŠ¸ë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.

**ğŸ“useSyncExternalStore**

tearing: ì°¢ì–´ì§„ë‹¤. í•˜ë‚˜ì˜ stateê°’ì´ ìˆìŒì—ë„ ì„œë¡œ ë‹¤ë¥¸ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë Œë”ë§ë˜ëŠ” í˜„ìƒ

- 18ì—ì„œëŠ” useTranstition, useDeferredValueì˜ í›…ì²˜ëŸ¼ ë Œë”ë§ì„ ì¼ì‹œ ì¤‘ì§€í•˜ê±°ë‚˜ ë’¤ë¡œ ë¯¸ë£¨ëŠ” ë“±ì˜ ìµœì í™”ê°€ ê°€ëŠ¥í•´ì§€ë©´ì„œ ë™ì‹œì„± ì´ìŠˆê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

![alt text](image-2.png)

1. ì²« ë²ˆì§¸ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ì™¸ë¶€ ë°ì´í„° ìŠ¤í† ì–´ì˜ ê°’ì´ íŒŒë€ìƒ‰ì´ì—ˆìœ¼ë¯€ë¡œ íŒŒë€ìƒ‰ ë Œë”ë§.
2. ë‚˜ë¨¸ì§€ ì»´í¬ë„ŒíŠ¸ë“¤ë„ íŒŒë€ìƒ‰ìœ¼ë¡œ ë Œë”ë§ ì¤€ë¹„
3. ê°‘ìê¸° ì™¸ë¶€ ë°ì´í„° ìŠ¤í† ì–´ì˜ ê°’ì´ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½
4. ë‚˜ë¨¸ì§€ ì»´í¬ë„ŒíŠ¸ë“¤ì€ ë Œë”ë§ ë„ì¤‘ì— ë°”ë€ ìƒ‰ì„ í™•ì¸í•´ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë Œë”ë§
5. **ê²°ê³¼ì ìœ¼ë¡œ ê°™ì€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ë°”ë¼ë³´ê³  ìˆìŒì—ë„ ì»´í°ë„ŒíŠ¸ ìƒ‰ìƒì´ ë‹¬ë¼ì§€ëŠ” í…Œì–´ë§í˜„ìƒ ë°œìƒ..!**

```jsx
const state = useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot)
// subscribe: ìŠ¤í† ì–´ì˜ ìƒíƒœ ë³€ê²½ì„ êµ¬ë…í•˜ëŠ” í•¨ìˆ˜.
// getSnapshot: í˜„ì¬ ìŠ¤í† ì–´ ìƒíƒœë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜.
// getServerSnapshot: SSRì„ ìœ„í•œ í˜„ì¬ ìŠ¤í† ì–´ ìƒíƒœë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ (ì„ íƒ ì‚¬í•­).
```

```jsx
1. ì™¸ë¶€ ìŠ¤í† ì–´ ì •ì˜
// store.js
// ìŠ¤í† ì–´ì˜ ìƒíƒœ
let count = 0;
// ìƒíƒœ ë³€ê²½ ì‹œ í˜¸ì¶œë˜ëŠ” êµ¬ë…ì ëª©ë¡
const listeners = new Set();

// ìƒíƒœë¥¼ ë³€ê²½í•˜ê³  êµ¬ë…ìì—ê²Œ ì•Œë¦¬ëŠ” í•¨ìˆ˜
export const increment = () => {
  count += 1;
  listeners.forEach(listener => listener());
};

export const subscribe = (listener) => {
  listeners.add(listener);
  return () => listeners.delete(listener);
};

// í˜„ì¬ ìŠ¤í† ì–´ ìƒíƒœë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
export const getSnapshot = () => count;

```

```jsx
2. ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
// Counter.js
import React from 'react';
import { useSyncExternalStore } from 'react';
import { subscribe, getSnapshot, increment } from './store';

const Counter = () => {
  const count = useSyncExternalStore(subscribe, getSnapshot);

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={increment}>Increment</button>
    </div>
  );
};

export default Counter;

```

- `useSyncExternalStore`ëŠ” ì™¸ë¶€ ìŠ¤í† ì–´ì˜ ìƒíƒœë¥¼ êµ¬ë…í•˜ê³ , ìƒíƒœ ë³€ê²½ ì‹œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë™ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.
- `subscribe`, `getSnapshot`, `getServerSnapshot` í•¨ìˆ˜ë¥¼ í†µí•´ ì™¸ë¶€ ìŠ¤í† ì–´ì™€ì˜ í†µí•©ì„ ì‰½ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

â†’ Redux, Zustand ë“± ì™¸ë¶€ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì›í™œí•˜ê²Œ í†µí•©í•  ìˆ˜ ìˆë‹¤.

**ğŸ“useInsertionEffect**

- CSS in jsë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìœ„í•œ í›…
- ë¸Œë¼ìš°ì €ê°€ DOMì„ ì—…ë°ì´íŠ¸í•˜ê¸° ì „ì— DOMì„ ë³€ê²½í•  í•„ìš”ê°€ ìˆì„ ë•Œ ì‚¬ìš©í•¨.

```jsx
import React, { useInsertionEffect, useState } from 'react'

const MyComponent = () => {
  const [color, setColor] = useState('red')

  useInsertionEffect(() => {
    // ìŠ¤íƒ€ì¼ íƒœê·¸ ìƒì„± ë° ì‚½ì…
    const style = document.createElement('style')
    style.innerHTML = `
      .my-class {
        color: ${color};
      }
    `
    document.head.appendChild(style)

    // í´ë¦°ì—… í•¨ìˆ˜ë¡œ ì´ì „ ìŠ¤íƒ€ì¼ íƒœê·¸ ì œê±°
    return () => {
      document.head.removeChild(style)
    }
  }, [color])

  return (
    <div className="my-class">
      This text will be {color}
      <button onClick={() => setColor('blue')}>Change to blue</button>
    </div>
  )
}

export default MyComponent
```

**âœ¨react-dom/client**

**ğŸ“createRoot**

- ê¸°ì¡´ react-domì— ìˆë˜ renderë©”ì„œë“œë¥¼ ëŒ€ì²´í•  ìƒˆë¡œìš´ ë©”ì„œë“œ
- ë™ì‹œì„± ê¸°ëŠ¥(concurrent features)ì„ í™œìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

```jsx
// index.js
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'

// ê¸°ì¡´ì˜ ReactDOM.render ëŒ€ì‹  createRoot ì‚¬ìš©
const container = document.getElementById('root')
const root = ReactDOM.createRoot(container)

root.render(<App />)
```

**ğŸ“hydrateRoot**

- SSR ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í•˜ì´ë“œë ˆì´ì…˜ì„ í•˜ê¸° ìœ„í•œ ìƒˆë¡œìš´ ë©”ì„œë“œ (API)
- ì´ APIëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì´ë¯¸ ì„œë²„ì—ì„œ ë Œë”ë§ëœ HTMLì„ ë°›ì•„ì„œ ì´ˆê¸° ë¡œë“œ ì‹œê°„ì„ ë‹¨ì¶•í•˜ê³ , ì´ˆê¸° í˜ì´ì§€ ë¡œë“œì—ì„œ ì‚¬ìš©ìì—ê²Œ ë” ë¹ ë¥¸ ì‘ë‹µì„ ì œê³µí•œë‹¤.

```jsx
// ì„œë²„ ì½”ë“œ (ì˜ˆ: Expressì™€ ReactDOMServer ì‚¬ìš©)
// server.js
import express from 'express'
import React from 'react'
import ReactDOMServer from 'react-dom/server'
import App from './App'

const app = express()

app.get('/', (req, res) => {
  const appHtml = ReactDOMServer.renderToString(<App />)
  const html = `
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>React App</title>
      </head>
      <body>
        <div id="root">${appHtml}</div>
        <script src="/client.js"></script>
      </body>
    </html>
  `
  res.send(html)
})

app.listen(3000, () => {
  console.log('Server is running on http://localhost:3000')
})
```

```jsx
// í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ
// index.js
import React from 'react'
import { hydrateRoot } from 'react-dom/client'
import App from './App'

// ì„œë²„ì—ì„œ ë Œë”ë§ëœ HTMLì´ ìˆëŠ” ë£¨íŠ¸ DOM ìš”ì†Œë¥¼ ì„ íƒ
const container = document.getElementById('root')

// hydrateRootë¥¼ ì‚¬ìš©í•˜ì—¬ í•˜ì´ë“œë ˆì´ì…˜
hydrateRoot(container, <App />)
```

**âœ¨react-dom/server**

**ğŸ“renderToPipeableStream**

- ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ë¥¼ HTMLë¡œ ë Œë”ë§í•˜ëŠ” ë©”ì„œë“œ
- ìŠ¤íŠ¸ë¦¼ì„ ì§€ì›í•˜ëŠ” ë©”ì„œë“œë¡œ, HTMLì„ ì ì§„ì ìœ¼ë¡œ ë Œë”ë§í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ì¤‘ê°„ì— scriptë¥¼ ì‚½ì…í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ í•  ìˆ˜ ìˆë‹¤.
- ì„œë²„ì—ì„œëŠ” suspenseë¥¼ ì‚¬ìš©í•´ ë¹ ë¥´ê²Œ ë Œë”ë§ì´ í•„ìš”í•œ ë¶€ë¶„ì„ ë¨¼ì € ë Œë”ë§í•  ìˆ˜ ìˆë‹¤.

> â“Suspense <br/>
> Reactì—ì„œ ë¹„ë™ê¸° ì‘ì—…(ì˜ˆ: ë°ì´í„° ë¡œë”©, ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… ë“±)ì„ ì²˜ë¦¬í•˜ëŠ” ë™ì•ˆ ë¡œë”© ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ë„ì…ëœ ì»´í¬ë„ŒíŠ¸.
> ëŒ€ê¸° ì¤‘ì¸ ë¹„ë™ê¸° ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ì²´ UIë¥¼ í‘œì‹œí•˜ë©°, í•´ë‹¹ ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•œë‹¤.

```jsx
// ì„œë²„ ì½”ë“œ (Expressì™€ renderToPipeableStream ì‚¬ìš©)
// server.js
import express from 'express'
import React from 'react'
import { renderToPipeableStream } from 'react-dom/server'
import App from './App'

const app = express()

app.get('/', (req, res) => {
  let didError = false // ì˜¤ë¥˜ ë°œìƒ ì—¬ë¶€ ì¶”ì 

  // renderToPipeableStreamì„ ì‚¬ìš©í•˜ì—¬ React ì»´í¬ë„ŒíŠ¸ë¥¼ HTMLë¡œ ë Œë”ë§
  const { pipe } = renderToPipeableStream(<App />, {
    // ì´ˆê¸° HTMLì´ ì¤€ë¹„ë˜ì—ˆì„ ë•Œ í˜¸ì¶œ
    onShellReady() {
      res.statusCode = didError ? 500 : 200
      res.setHeader('Content-Type', 'text/html')
      pipe(res) // ë Œë”ë§ëœ HTMLì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ìŠ¤íŠ¸ë¦¼
    },
    // ì´ˆê¸° HTMLì„ ë Œë”ë§í•˜ëŠ” ë™ì•ˆ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ í˜¸ì¶œ
    onShellError() {
      res.statusCode = 500
      res.send('<h1>Server Error</h1>')
    },
    // ë Œë”ë§ ë„ì¤‘ ë°œìƒí•œ ëª¨ë“  ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬
    onError(error) {
      didError = true
      console.error(error)
    },
  })
})

app.listen(3000, () => {
  console.log('Server is running on http://localhost:3000')
})
```

**ğŸ“ renderToReadableStream**

- ì›¹ ìŠ¤íŠ¸ë¦¼ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ë™í•œë‹¤.
- ì„œë²„í™˜ê²½ì´ ì•„ë‹Œ í´ë¼ìš°ë“œí”Œë ˆì–´ë‚˜ ë””ë…¸ ê°™ì€ ì›¹ ìŠ¤íŠ¸ë¦¼ì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë˜ ì—£ì§€ ëŸ°íƒ€ì„ í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë©”ì„œë“œ

**âœ¨ìë™ ë°°ì¹˜(Automatic Batching)**

- ë¦¬ì•¡íŠ¸ê°€ ì—¬ëŸ¬ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ í•˜ë‚˜ì˜ ë¦¬ë Œë”ë§ìœ¼ë¡œ ë¬¶ì–´ì„œ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” ë°©ë²•

```jsx
// React 18 ì´ì „
import React, { useState } from 'react'

function App() {
  const [count, setCount] = useState(0)
  const [text, setText] = useState('')

  const handleClick = () => {
    setTimeout(() => {
      setCount((c) => c + 1)
      setText('Updated') // ë‘ ë²ˆì˜ ë Œë”ë§ ë°œìƒ
    }, 1000)
  }

  console.log('Rendered') // ë‘ ë²ˆ ì°í˜

  return (
    <div>
      <p>Count: {count}</p>
      <p>Text: {text}</p>
      <button onClick={handleClick}>Update</button>
    </div>
  )
}

export default App
```

```jsx
// React 18 ì´í›„

import React, { useState } from 'react'

function App() {
  const [count, setCount] = useState(0)
  const [text, setText] = useState('')

  const handleClick = () => {
    setTimeout(() => {
      setCount((c) => c + 1)
      setText('Updated') // í•œ ë²ˆì˜ ë Œë”ë§ ë°œìƒ
    }, 1000)
  }

  console.log('Rendered') // í•œ ë²ˆ ì°í˜

  return (
    <div>
      <p>Count: {count}</p>
      <p>Text: {text}</p>
      <button onClick={handleClick}>Update</button>
    </div>
  )
}

export default App
```

**âœ¨ë”ìš± ì—„ê²©í•´ì§„ ì—„ê²©ëª¨ë“œ**

**ğŸ“ë¦¬ì•¡íŠ¸ì˜ ì—„ê²©ëª¨ë“œ**

- ë¦¬ì•¡íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œìƒí•  ìˆ˜ë„ ìˆëŠ” ì ì¬ì ì¸ ë²„ê·¸ë¥¼ ì°¾ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ì»´í¬ë„ŒíŠ¸
  - ë” ì´ìƒ ì•ˆì „í•˜ì§€ ì•Šì€ íŠ¹ì • ìƒëª…ì£¼ê¸°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì— ëŒ€í•œ ê²½ê³ 
  - ë¬¸ìì—´ refì‚¬ìš© ê¸ˆì§€
  - findDOMNodeì— ëŒ€í•œ ê²½ê³  ì¶œë ¥
  - êµ¬ Context API ì‚¬ìš© ì‹œ ë°œìƒí•˜ëŠ” ê²½ê³ 
  - ì˜ˆìƒì¹˜ ëª»í•œ ë¶€ì‘ìš©(side-effects) ê²€ì‚¬

**ì—„ê²©ëª¨ë“œë¥¼ í™œì„±í™”í•˜ë ¤ë©´ `<React.StrictMode>`ë¡œ ê°ì‹¸ë©´ ëœë‹¤.**

> ë¶€ì‘ìš©(side-effects)
>
> - í´ë˜ìŠ¤í˜• ì»´í¬ë„ŒíŠ¸ì˜ constructor, render, shouldComponentUpdate, getDerivedStateFromProps
> - í´ë˜ìŠ¤í˜• ì»´í¬ë„ŒíŠ¸ì˜ setStateì˜ ì²« ë²ˆì§¸ ì¸ìˆ˜
> - í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ì˜ body
> - useState, useMemo, useReducerì— ì „ë‹¬ë˜ëŠ” í•¨ìˆ˜

**ğŸ“ë¦¬ì•¡íŠ¸ 18ì—ì„œ ì¶”ê°€ëœ ì—„ê²© ëª¨ë“œ**

- ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ í•´ì œëœ ìƒíƒœì—ì„œë„ (ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ íŠ¸ë¦¬ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìƒíƒœì—ì„œë„) ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì˜ ìƒíƒœê°’ì„ ìœ ì§€í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•  ì˜ˆì •ì„.

ex) ì‚¬ìš©ìê°€ ë’¤ë¡œê°€ê¸°ë¥¼ í–ˆë‹¤ê°€ ë‹¤ì‹œ í˜„ì¬ í™”ë©´ìœ¼ë¡œ ëŒì•„ì™”ì„ ë•Œ ë¦¬ì•¡íŠ¸ê°€ ì¦‰ì‹œ ì´ì „ì˜ ìƒíƒœë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•´ í‘œì‹œí•  ì¤€ë¹„ë¥¼ í•˜ëŠ” ê²ƒ..

- ì»´í¬ë„ŒíŠ¸ê°€ ìµœì´ˆì— ë§ˆìš´íŠ¸ë  ë•Œ ìë™ìœ¼ë¡œ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ë§ˆìš´íŠ¸ í•´ì œí•˜ê³ , ë‘ ë²ˆì§¸ ë§ˆìš´íŠ¸ì—ì„œ ì´ì „ ìƒíƒœë¥¼ ë³µì›í•˜ê²Œ ëœë‹¤. (ê°œë°œ ëª¨ë“œì—ì„œë§Œ ì ìš©)

**âœ¨Suspense ê¸°ëŠ¥ ê°•í™”**

- ì»´í¬ë„ŒíŠ¸ë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ê¸°ëŠ¥

```jsx
import React, { Suspense, lazy } from 'react'

// Lazy Component
const LazyComponent = lazy(() => import('./LazyComponent'))

const App = () => {
  return (
    <div>
      <h1>My App</h1>
      <Suspense fallback={<div>Loading...</div>}>
        <LazyComponent />
      </Suspense>
    </div>
  )
}

export default App
```

- Suspenseë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ì ¸ì˜¤ê³ , ë¡œë”© ìƒíƒœë¥¼ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
- ì»´í¬ë„ŒíŠ¸ê°€ ë¡œë“œë˜ëŠ” ë™ì•ˆ fallback UIë¥¼ ì œê³µí•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ë¡œë”© ìƒíƒœë¥¼ ì•Œë¦°ë‹¤.
- SuspenseëŠ” ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§ê³¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆì–´, ì´ˆê¸° ë¡œë”© ì†ë„ë¥¼ ê°œì„ 

**âœ¨ì¸í„°ë„· ìµìŠ¤í”Œë¡œëŸ¬ ì§€ì› ì¤‘ë‹¨ì— ë”°ë¥¸ ì¶”ê°€ í´ë¦¬í•„ í•„ìš”**

- 18ì—ì„œëŠ” ë¦¬ì•¡íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œì—ì„œÂ `Promise`,Â `Symbol`,Â `Object.assign`Â ì´ ì„¸ ê°€ì§€ ìµœì‹  ìë°”ìŠ¤í¬ë¦½íŠ¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ê°€ì •í•˜ì— ë°°í¬ëœë‹¤.
- ë§Œì•½ ì´ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì„œë¹„ìŠ¤í•´ì•¼ í•œë‹¤ë©´ í´ë¦¬í•„ì„ ë°˜ë“œì‹œ ì¶”ê°€í•´ì•¼ í•œë‹¤.

| Promise       | ë¹„ë™ê¸° ì‘ì—…ì˜ ì™„ë£Œ/ì‹¤íŒ¨ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ |
| ------------- | --------------------------------------- |
| Symbol        | ê³ ìœ í•œ ì›ì‹œ ë°ì´í„° íƒ€ì…, ì†ì„± í‚¤ë¡œ ì‚¬ìš© |
| Object.assign | ê°ì²´ì˜ ì†ì„±ì„ ë³µì‚¬í•˜ì—¬ ë³‘í•©í•˜ëŠ” ë©”ì„œë“œ  |

**âœ¨ê·¸ ë°–ì— ì•Œì•„ë‘ë©´ ì¢‹ì€ ë³€ê²½ì‚¬í•­**

- ì»´í¬ë„ŒíŠ¸ì—ì„œÂ `undefined`ë¥¼ ë°˜í™˜í•´ë„ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.Â `undefined`Â ë°˜í™˜ì€Â `null`Â ë°˜í™˜ë„ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ëœë‹¤.
- `<Suspense fallback={undefined}>`ë„Â `null`ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ëœë‹¤.
- `renderToNodeStream`ì´ ì§€ì› ì¤‘ë‹¨ë¼ì„œÂ `renderToPipeableStream`Â ì‚¬ìš©ì„ ê¶Œì¥í•œë‹¤.

## ì°¸ê³ 

- https://blog.mathpresso.com/react-deep-dive-react-event-system-2-1d0ad028308b
