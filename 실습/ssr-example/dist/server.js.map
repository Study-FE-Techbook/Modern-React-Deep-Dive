{"version":3,"file":"server.js","mappings":"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","sources":["webpack://ssr-example/./public/index-end.html","webpack://ssr-example/./public/index-front.html","webpack://ssr-example/./public/index.html","webpack://ssr-example/./src/components/App.tsx","webpack://ssr-example/./src/components/Todo.tsx","webpack://ssr-example/./src/fetch/index.ts","webpack://ssr-example/./src/server.ts","webpack://ssr-example/external commonjs \"isomorphic-fetch\"","webpack://ssr-example/external commonjs \"react\"","webpack://ssr-example/external commonjs \"react-dom/server\"","webpack://ssr-example/external node-commonjs \"fs\"","webpack://ssr-example/external node-commonjs \"http\"","webpack://ssr-example/webpack/bootstrap","webpack://ssr-example/webpack/runtime/define property getters","webpack://ssr-example/webpack/runtime/hasOwnProperty shorthand","webpack://ssr-example/webpack/runtime/make namespace object","webpack://ssr-example/webpack/startup"],"sourcesContent":["export default \"<script src=\\\"https://unpkg.com/react@17.0.2/umd/react.development.js\\\"></script>\\n<script src=\\\"https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js\\\"></script>\\n<script src=\\\"/browser.js\\\"></script>\\n</body>\\n</html>\";","export default \"<!DOCTYPE html>\\n<html>\\n  <head>\\n    <meta charset=\\\"utf-8\\\" />\\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" />\\n    <title>SSR Example</title>\\n  </head>\\n  <body>\\n\\n\";","export default \"<!DOCTYPE html>\\n<html>\\n  <head>\\n    <meta charset=\\\"utf-8\\\" />\\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" />\\n    <title>SSR Example</title>\\n  </head>\\n  <body>\\n    __placeholder__\\n    <script src=\\\"https://unpkg.com/react@17.0.2/umd/react.development.js\\\"></script>\\n    <script src=\\\"https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js\\\"></script>\\n    <script src=\\\"/browser.js\\\"></script>\\n  </body>\\n</html>\\n\";","import React, { useEffect } from 'react'\n\nimport { TodoResponse } from '../fetch'\n\nimport { Todo } from './Todo'\n\nexport default function App({ todos }: { todos: Array<TodoResponse> }) {\n  useEffect(() => {\n    console.log('하이!') // eslint-disable-line no-console\n  }, [])\n\n  return (\n    <>\n      <h1>나의 할일!</h1>\n      <ul>\n        {todos.map((todo, index) => (\n          <Todo key={index} todo={todo} />\n        ))}\n      </ul>\n    </>\n  )\n}\n","import React, { useState } from 'react'\n\nimport { TodoResponse } from '../fetch'\n\nexport function Todo({ todo }: { todo: TodoResponse }) {\n  const { title, completed, userId, id } = todo\n  const [finished, setFinished] = useState(completed)\n\n  function handleClick() {\n    setFinished((prev) => !prev)\n  }\n\n  return (\n    <li>\n      <span>\n        {userId}-{id}) {title} {finished ? '완료' : '미완료'}\n        <button onClick={handleClick}>토글</button>\n      </span>\n    </li>\n  )\n}\n","import fetch from 'isomorphic-fetch'\n\nexport interface TodoResponse {\n  userId: number\n  id: number\n  title: string\n  completed: boolean\n}\n\nexport async function fetchTodo() {\n  const response = await fetch('https://jsonplaceholder.typicode.com/todos')\n  const result: TodoResponse[] = await response.json()\n  return result\n  // 스트림의 극단적인 예제를 보고 싶다면 주석 해제\n  // return Array(10).fill(result).flat()\n}\n","import { createServer, IncomingMessage, ServerResponse } from 'http'\nimport { createReadStream } from 'fs'\n\nimport { renderToNodeStream, renderToString } from 'react-dom/server'\nimport { createElement } from 'react'\n\nimport html from '../public/index.html'\nimport indexFront from '../public/index-front.html'\nimport indexEnd from '../public/index-end.html'\n\nimport App from './components/App'\nimport { fetchTodo } from './fetch'\n\nconst PORT = process.env.PORT || 3000\n\nasync function serverHandler(req: IncomingMessage, res: ServerResponse) {\n  const { url } = req\n\n  switch (url) {\n    case '/': {\n      const result = await fetchTodo()\n\n      const rootElement = createElement(\n        'div',\n        { id: 'root' },\n        createElement(App, { todos: result }),\n      )\n      const renderResult = renderToString(rootElement)\n\n      const htmlResult = html.replace('__placeholder__', renderResult)\n\n      res.setHeader('Content-Type', 'text/html')\n      res.write(htmlResult)\n      res.end()\n      return\n    }\n\n    case '/stream': {\n      res.setHeader('Content-Type', 'text/html')\n      res.write(indexFront)\n\n      const result = await fetchTodo()\n      const rootElement = createElement(\n        'div',\n        { id: 'root' },\n        createElement(App, { todos: result }),\n      )\n\n      const stream = renderToNodeStream(rootElement)\n      stream.pipe(res, { end: false })\n      stream.on('end', () => {\n        res.write(indexEnd)\n        res.end()\n      })\n      return\n    }\n\n    case '/browser.js': {\n      res.setHeader('Content-Type', 'application/javascript')\n      createReadStream(`./dist/browser.js`).pipe(res)\n      return\n    }\n\n    case '/browser.js.map': {\n      res.setHeader('Content-Type', 'application/javascript')\n      createReadStream(`./dist/browser.js.map`).pipe(res)\n      return\n    }\n\n    default: {\n      res.statusCode = 404\n      res.end('404 Not Found')\n    }\n  }\n}\n\nfunction main() {\n  createServer(serverHandler).listen(PORT, () => {\n    console.log(`Server has been started ${PORT}...`) // eslint-disable-line no-console\n  })\n}\n\nmain()\n","module.exports = require(\"isomorphic-fetch\");","module.exports = require(\"react\");","module.exports = require(\"react-dom/server\");","module.exports = require(\"fs\");","module.exports = require(\"http\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(728);\n"],"names":["todos","useEffect","console","log","map","todo","index","Todo","key","title","completed","userId","id","finished","setFinished","useState","onClick","prev","async","response","json","PORT","process","env","createServer","req","res","url","result","fetchTodo","rootElement","createElement","renderResult","renderToString","htmlResult","replace","setHeader","write","end","stream","renderToNodeStream","pipe","on","createReadStream","statusCode","listen","module","exports","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call","d","definition","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","r","Symbol","toStringTag","value"],"sourceRoot":""}